{"version":3,"file":"commonHelpers.js","sources":["../src/main.js"],"sourcesContent":["import iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\n\nimport SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\n\nimport axios from 'axios';\n\nconst refs = {\n  gallery: document.querySelector('.gallery-container'),\n  form: document.querySelector('.form'),\n  loader: document.querySelector('.loader'),\n  loadMoreBtn: document.querySelector('.btn-load-more'),\n};\n\nconst queryParams = {\n  query: '',\n  page: 1,\n  maxPage: 0,\n  per_page: 40,\n};\n\nconst lightbox = new SimpleLightbox('.gallery-link', {\n  captions: true,\n  captionSelector: 'img',\n  captionDelay: 250,\n  captionPosition: 'bottom',\n  captionsData: 'alt',\n});\n\nrefs.form.addEventListener('submit', imageSearch);\nrefs.loadMoreBtn.addEventListener('click', loadMore);\n\nasync function imageSearch(e) {\n  e.preventDefault();\n\n  const form = e.currentTarget;\n\n  const input = form.elements.query;\n  const searchBtn = form.elements.searchBtn;\n\n  refs.gallery.innerHTML = '';\n  refs.loader.classList.add('show');\n  searchBtn.disabled = true;\n  refs.query = input.value.trim();\n  refs.loadMoreBtn.classList.add('is-hidden');\n\n  const toast = document.querySelector('.iziToast');\n  if (toast) {\n    iziToast.hide(\n      {\n        transitionOut: 'fadeOutUp',\n      },\n      toast\n    );\n  }\n\n  if (!refs.query) {\n    return;\n  }\n\n  try {\n    const { hits, totalHits } = await fetchImages(refs.query);\n\n    queryParams.maxPage = Math.ceil(totalHits / queryParams.per_page);\n\n    renderImages(hits);\n    updateModal();\n\n    if (hits.length && hits.length !== totalHits) {\n      refs.loadMoreBtn.classList.remove('is-hidden');\n    } else if (!hits.length) {\n      iziToast.show({\n        message: `Sorry, there are no images matching your search query. Please, try again!`,\n        messageColor: '#FAFAFB',\n        messageSize: '16px',\n        messageLineHeight: '24px',\n        color: '#EF4040',\n        progressBarColor: '#B51B1B',\n        position: 'topRight',\n        icon: 'icon-cancel',\n        iconColor: '#FAFAFB',\n      });\n    }\n  } catch (error) {\n    console.log(error);\n  } finally {\n    refs.loader.classList.remove('show');\n\n    form.reset();\n\n    searchBtn.disabled = false;\n\n    queryParams.page = 1;\n  }\n}\n\nasync function fetchImages(searchWord) {\n  const params = {\n    key: '41767472-d86fe691fef3335ff5b770a4f',\n    q: `${searchWord}`,\n    image_type: 'photo',\n    orientation: 'horizontal',\n    safesearch: true,\n    page: queryParams.page,\n    per_page: queryParams.per_page,\n  };\n\n  const url = `https://pixabay.com/api/`;\n\n  return axios.get(`${url}`, { params }).then(({ data }) => data);\n}\n\nfunction renderImages(images) {\n  const markup = images\n    .map(\n      ({\n        webformatURL,\n        largeImageURL,\n        tags,\n        likes,\n        views,\n        comments,\n        downloads,\n      }) => {\n        return `\n            <li class=\"gallery-item\">\n                <a href=\"${largeImageURL}\" class=\"gallery-link\">\n                    <img src=\"${webformatURL}\" alt=\"${tags}\" data-source=\"${largeImageURL}\">\n                </a>\n                \n                <ul class=\"gallery-info-container\">\n                    <li class=\"gallery-info\">\n                        <p class=\"gallery-info-name\">Likes</p>\n                        <p class=\"gallery-info-value\">${likes}</p>\n                    </li>\n\n                    <li class=\"gallery-info\">\n                        <p class=\"gallery-info-name\">Views</p>\n                        <p class=\"gallery-info-value\">${views}</p>\n                    </li>\n\n                    <li class=\"gallery-info\">\n                        <p class=\"gallery-info-name\">Comments</p>\n                        <p class=\"gallery-info-value\">${comments}</p>\n                    </li>\n\n                    <li class=\"gallery-info\">\n                        <p class=\"gallery-info-name\">Downloads</p>\n                        <p class=\"gallery-info-value\">${downloads}</p>\n                    </li>\n                </ul>\n            </li>\n      `;\n      }\n    )\n    .join('');\n\n  refs.gallery.insertAdjacentHTML('beforeend', markup);\n}\n\nfunction updateModal() {\n  lightbox.refresh();\n}\n\nasync function loadMore() {\n  queryParams.page += 1;\n\n  refs.loader.classList.add('show');\n  refs.loadMoreBtn.classList.add('is-hidden');\n\n  try {\n    const { hits } = await fetchImages(queryParams.query);\n\n    renderImages(hits);\n    updateModal();\n  } catch (error) {\n    console.log(error);\n  } finally {\n    refs.loader.classList.remove('show');\n  }\n\n  if (queryParams.page === queryParams.maxPage) {\n    iziToast.show({\n      message: `We're sorry, but you've reached the end of search results.`,\n      messageColor: '#000',\n      messageSize: '16px',\n      messageLineHeight: '24px',\n      color: '#6C8CFF',\n      position: 'topRight',\n      icon: 'icon-info',\n      iconColor: '#000',\n    });\n  } else {\n    refs.loadMoreBtn.classList.remove('is-hidden');\n\n    const cardHeight = document\n      .querySelector('.gallery-item')\n      .getBoundingClientRect().height;\n\n    window.scrollBy({\n      top: cardHeight * 2,\n      behavior: 'smooth',\n    });\n  }\n}\n"],"names":["refs","queryParams","lightbox","SimpleLightbox","imageSearch","loadMore","e","form","input","searchBtn","toast","iziToast","hits","totalHits","fetchImages","renderImages","updateModal","error","searchWord","params","url","axios","data","images","markup","webformatURL","largeImageURL","tags","likes","views","comments","downloads","cardHeight"],"mappings":"owBAQA,MAAMA,EAAO,CACX,QAAS,SAAS,cAAc,oBAAoB,EACpD,KAAM,SAAS,cAAc,OAAO,EACpC,OAAQ,SAAS,cAAc,SAAS,EACxC,YAAa,SAAS,cAAc,gBAAgB,CACtD,EAEMC,EAAc,CAClB,MAAO,GACP,KAAM,EACN,QAAS,EACT,SAAU,EACZ,EAEMC,EAAW,IAAIC,EAAe,gBAAiB,CACnD,SAAU,GACV,gBAAiB,MACjB,aAAc,IACd,gBAAiB,SACjB,aAAc,KAChB,CAAC,EAEDH,EAAK,KAAK,iBAAiB,SAAUI,CAAW,EAChDJ,EAAK,YAAY,iBAAiB,QAASK,CAAQ,EAEnD,eAAeD,EAAYE,EAAG,CAC5BA,EAAE,eAAc,EAEhB,MAAMC,EAAOD,EAAE,cAETE,EAAQD,EAAK,SAAS,MACtBE,EAAYF,EAAK,SAAS,UAEhCP,EAAK,QAAQ,UAAY,GACzBA,EAAK,OAAO,UAAU,IAAI,MAAM,EAChCS,EAAU,SAAW,GACrBT,EAAK,MAAQQ,EAAM,MAAM,KAAI,EAC7BR,EAAK,YAAY,UAAU,IAAI,WAAW,EAE1C,MAAMU,EAAQ,SAAS,cAAc,WAAW,EAUhD,GATIA,GACFC,EAAS,KACP,CACE,cAAe,WAChB,EACDD,CACN,EAGM,EAACV,EAAK,MAIV,GAAI,CACF,KAAM,CAAE,KAAAY,EAAM,UAAAC,CAAW,EAAG,MAAMC,EAAYd,EAAK,KAAK,EAExDC,EAAY,QAAU,KAAK,KAAKY,EAAYZ,EAAY,QAAQ,EAEhEc,EAAaH,CAAI,EACjBI,IAEIJ,EAAK,QAAUA,EAAK,SAAWC,EACjCb,EAAK,YAAY,UAAU,OAAO,WAAW,EACnCY,EAAK,QACfD,EAAS,KAAK,CACZ,QAAS,4EACT,aAAc,UACd,YAAa,OACb,kBAAmB,OACnB,MAAO,UACP,iBAAkB,UAClB,SAAU,WACV,KAAM,cACN,UAAW,SACnB,CAAO,CAEJ,OAAQM,EAAP,CACA,QAAQ,IAAIA,CAAK,CACrB,QAAY,CACRjB,EAAK,OAAO,UAAU,OAAO,MAAM,EAEnCO,EAAK,MAAK,EAEVE,EAAU,SAAW,GAErBR,EAAY,KAAO,CACpB,CACH,CAEA,eAAea,EAAYI,EAAY,CACrC,MAAMC,EAAS,CACb,IAAK,qCACL,EAAG,GAAGD,IACN,WAAY,QACZ,YAAa,aACb,WAAY,GACZ,KAAMjB,EAAY,KAClB,SAAUA,EAAY,QAC1B,EAEQmB,EAAM,2BAEZ,OAAOC,EAAM,IAAI,GAAGD,IAAO,CAAE,OAAAD,CAAQ,CAAA,EAAE,KAAK,CAAC,CAAE,KAAAG,CAAM,IAAKA,CAAI,CAChE,CAEA,SAASP,EAAaQ,EAAQ,CAC5B,MAAMC,EAASD,EACZ,IACC,CAAC,CACC,aAAAE,EACA,cAAAC,EACA,KAAAC,EACA,MAAAC,EACA,MAAAC,EACA,SAAAC,EACA,UAAAC,CACR,IACe;AAAA;AAAA,2BAEYL;AAAA,gCACKD,WAAsBE,mBAAsBD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wDAMpBE;AAAA;AAAA;AAAA;AAAA;AAAA,wDAKAC;AAAA;AAAA;AAAA;AAAA;AAAA,wDAKAC;AAAA;AAAA;AAAA;AAAA;AAAA,wDAKAC;AAAA;AAAA;AAAA;AAAA,OAMnD,EACA,KAAK,EAAE,EAEV/B,EAAK,QAAQ,mBAAmB,YAAawB,CAAM,CACrD,CAEA,SAASR,GAAc,CACrBd,EAAS,QAAO,CAClB,CAEA,eAAeG,GAAW,CACxBJ,EAAY,MAAQ,EAEpBD,EAAK,OAAO,UAAU,IAAI,MAAM,EAChCA,EAAK,YAAY,UAAU,IAAI,WAAW,EAE1C,GAAI,CACF,KAAM,CAAE,KAAAY,CAAI,EAAK,MAAME,EAAYb,EAAY,KAAK,EAEpDc,EAAaH,CAAI,EACjBI,GACD,OAAQC,EAAP,CACA,QAAQ,IAAIA,CAAK,CACrB,QAAY,CACRjB,EAAK,OAAO,UAAU,OAAO,MAAM,CACpC,CAED,GAAIC,EAAY,OAASA,EAAY,QACnCU,EAAS,KAAK,CACZ,QAAS,6DACT,aAAc,OACd,YAAa,OACb,kBAAmB,OACnB,MAAO,UACP,SAAU,WACV,KAAM,YACN,UAAW,MACjB,CAAK,MACI,CACLX,EAAK,YAAY,UAAU,OAAO,WAAW,EAE7C,MAAMgC,EAAa,SAChB,cAAc,eAAe,EAC7B,sBAAqB,EAAG,OAE3B,OAAO,SAAS,CACd,IAAKA,EAAa,EAClB,SAAU,QAChB,CAAK,CACF,CACH"}